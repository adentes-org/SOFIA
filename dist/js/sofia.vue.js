"use strict";var S=S||{};S.vue={el:{pages:{}},map:{},init:function(){S.vue.declare_filter(),S.vue.declare_compoment(),S.vue.parse_template(),S.vue.init_menu(),S.vue.init_router()},declare_compoment:function(){Vue.component("fiche",{props:["f","u","l"],template:S.template.fiche}),Vue.component("app-header",{props:["options","searchbox"],template:S.template.header,methods:{onHeaderClick:function(){this.$data.options.onHeaderClick()}},computed:{displayedTitle:function(){return this.options.displaySearchbox&&"undefined"!=typeof this.options.titleInSearch&&""!==this.options.titleInSearch&&this.searchbox.length>0?this.options.titleInSearch:this.options.title}}})},declare_filter:function(){Vue.filter("formatTime",function(e){var t=new Date(e);return S.lang.the+" "+t.toLocaleDateString().slice(0,-5)+" "+S.lang.at+" "+t.toLocaleTimeString().slice(0,-3)})},generate_page:function(e){return Vue.extend($.extend({props:["searchbox"],template:S.template.page_wrapper(e,S.template.pages[e]),data:null,computed:null,methods:null,route:null},S.data.pages[e]))},parse_template:function(){for(var e in S.template.pages)S.template.pages.hasOwnProperty(e)&&(S.vue.el.pages[e]=S.vue.generate_page(e),S.vue.map["/"+e]={url:"/"+e,name:(S.lang[e]||e).capitalize(),component:S.vue.el.pages[e],options:S.data.pages[e]&&S.data.pages[e].options||{}})},updateOptions:function(e){if(e.options){var t=e.options,a=S.vue.router.app.$data,n=a.headerOptions;$.extend(n,{displaySearchbox:t.displaySearchbox,display:t.displayHeader,title:t.title,titleInSearch:t.titleInSearch,onHeaderClick:t.onHeaderClick}),a.quickAddButtonOptions.display="boolean"!=typeof t.displayQuickAddButton||t.displayQuickAddButton,a.MenuOptions.display="boolean"!=typeof t.displayMenu||t.displayMenu}},afterEach:function(e){console.log("Successfully navigated to: "+e.to.path,e.to.path.slice(1));var t=S.vue.map[e.to.fullPath];S.tool.isMenuEntry(e.to.path)&&(S.vue.el.menu.$set("current",t.name),$("head>title").text("SOFIA"+(t.name&&""!==t.name?" - "+t.name:""))),S.vue.updateOptions(t),"function"==typeof S.platform.events.afterPageLoad&&S.platform.events.afterPageLoad()},beforeEach:function(e){"/_login"===e.to.path||S.user._current.isLogged()?"/_login"===e.to.path&&S.user._current.isLogged()?e.abort():e.next():(""!==S.config.user.username&&""!==S.config.user.userpass&&S.user.login(S.config.user.username,S.config.user.userpass,!0).fail(function(t){switch(console.log(t),t.status){case 401:S.user.reset(),e.redirect("/_login");break;case 500:S.user._current.wasLoggedIn()&&(S.user._current.restoreSession(),S.db.fiches.startSync(),S.vue.router.go("/"));break;default:e.redirect("/_login")}}).then(function(e){console.log("Receiving the user : ",e),S.vue.router.go("/")}),e.redirect("/_login"))},init_router:function(){S.vue.el.App=Vue.extend({data:function(){return{searchbox:"",headerOptions:{title:"",display:!0,backColor:S.config.header.backColorOffline,displayLoadingBar:!1,displaySearchbox:!0,onHeaderClick:null},quickAddButtonOptions:{display:!0},MenuOptions:{display:!0}}}}),S.vue.router=new VueRouter,S.vue.router.map(S.vue.map),S.vue.router.beforeEach(S.vue.beforeEach),S.vue.router.afterEach(S.vue.afterEach),S.vue.router.redirect({"/":"/home","*":"/home"}),S.vue.router.start(S.vue.el.App,".app"),$("#menu a.mdl-navigation__link").each(function(e,t){$(t).attr("v-link",$(t).attr("link"))})},init_menu:function(){S.vue.el.menu=new Vue({el:"#menu",data:{current:"Login",links:S.vue.map},methods:{isMenuEntry:S.tool.isMenuEntry}})}};